const t=document.querySelector(".game-field"),e=document.querySelector(".game-score"),s=document.querySelector(".message-start"),a=document.querySelector(".message-lose"),r=document.querySelector(".message-win"),i=document.querySelector(".button"),n=Array.from({length:t.tBodies[0].rows.length},()=>Array(t.tBodies[0].rows[0].cells.length).fill(0));var l={};class o{static STATUSES={idle:"idle",playing:"playing",win:"win",lose:"lose"};constructor(t=[[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0]],e,s){this.initialState=t,this.state=t.map(t=>[...t]),this.status=o.STATUSES.idle,this.score=0,this.gameBoard=e,this.scoreField=s}getScore(){return this.score}getState(){return this.state}getStatus(){return this.status}start(){this.status=o.STATUSES.playing,this.#t(),this.#t()}restart(){this.state=this.initialState.map(t=>[...t]),this.status=o.STATUSES.idle,this.score=0}moveLeft(){if(this.status!==o.STATUSES.playing)return;let t=!1;this.state=this.state.map(e=>this.#e(e)?(t=!0,this.#s(e)):e),t&&this.#t(),this.#a()}moveRight(){if(this.status!==o.STATUSES.playing)return;let t=!1;this.state=this.state.map(e=>{let s=[...e].reverse();return this.#e(s)?(t=!0,this.#s(s).reverse()):e}),t&&this.#t(),this.#a()}moveUp(){if(this.status!==o.STATUSES.playing)return;let t=!1,e=this.#r(this.state).map(e=>this.#e(e)?(t=!0,this.#s(e)):e);this.state=this.#r(e),t&&this.#t(),this.#a()}moveDown(){if(this.status!==o.STATUSES.playing)return;let t=!1,e=this.#r(this.state).map(e=>{let s=[...e].reverse();return this.#e(s)?(t=!0,this.#s(s).reverse()):e});this.state=this.#r(e),t&&this.#t(),this.#a()}updateGameBoard(){let t=/field-cell--\d+/,e=this.getState();this.scoreField.innerText=this.getScore();for(let s=0;s<e.length;s++)for(let a=0;a<e.length;a++)0!==e[s][a]?(this.gameBoard.rows[s].cells[a].className=`field-cell field-cell--${e[s][a]}`,this.gameBoard.rows[s].cells[a].innerText=e[s][a]):0===e[s][a]&&t.test(this.gameBoard.rows[s].cells[a].className)&&(this.gameBoard.rows[s].cells[a].className="field-cell",this.gameBoard.rows[s].cells[a].innerText="")}#t(){let t=this.#i();null!==t&&(this.state[t[0]][t[1]]=.9>Math.random()?2:4)}#n(){let t=[];for(let e=0;e<this.state.length;e++)for(let s=0;s<this.state[0].length;s++)0===this.state[e][s]&&t.push([e,s]);return t}#i(){let t=this.#n();if(t.length<1)return null;let e=Math.floor(Math.random()*t.length);return t[e]}#r(t){return t[0].map((e,s)=>t.map(t=>t[s]))}#s(t){let e=[0,0,0,0];for(let s=1;s<t.length;s++){if(0===t[s])continue;let a=s,r=null,i=s-1;for(;i>=0&&(0===t[i]||t[i]===t[a]&&1!==e[i]);)r=i,i--;null!==r&&(0===t[r]?(t[r]=t[a],t[a]=0):(t[r]+=t[a],t[a]=0,e[r]=1,this.score+=t[r]))}return t}#a(){this.#l()||(this.status=o.STATUSES.lose),this.#o()&&(this.status=o.STATUSES.win)}#o(){return this.state.some(t=>t.some(t=>2048===t))}#l(){if(this.#n().length>=1)return!0;let t=this.state.some(t=>{let e=[...t];return!!(this.#e(t)||this.#e(e))}),e=this.#r(this.state).some(t=>{let e=[...t];return!!(this.#e(t)||this.#e(e))});return t||e}#e(t){return t.some((e,s)=>0!==s&&0!==e&&(0===t[s-1]||t[s]===t[s-1]))}}const h=new(l=o)(n,t.tBodies[0],e);function c(){let t,e,s,a;window.addEventListener("keydown",d,{once:!0}),t=0,e=0,s=0,a=0,window.addEventListener("touchstart",s=>{t=s.touches[0].clientX,e=s.touches[0].clientY},{once:!0}),window.addEventListener("touchend",r=>{s=r.changedTouches[0].clientX,a=r.changedTouches[0].clientY,function(){let r=s-t,i=a-e;Math.abs(r)>Math.abs(i)?r>50?h.moveRight():r<-50&&h.moveLeft():i>50?h.moveDown():i<-50&&h.moveUp(),u()}()},{once:!0})}function d(t){switch(t.key){case"ArrowDown":h.moveDown();break;case"ArrowUp":h.moveUp();break;case"ArrowLeft":h.moveLeft();break;case"ArrowRight":h.moveRight();break;default:c();return}u()}function u(){h.updateGameBoard();let t=h.getStatus();t===l.STATUSES.win&&r.classList.remove("hidden"),t===l.STATUSES.lose&&a.classList.remove("hidden"),c()}i.addEventListener("click",()=>{i.classList.contains("start")?(h.start(),i.classList.remove("start"),i.classList.add("restart"),i.innerText="Restart",s.classList.add("hidden")):i.classList.contains("restart")&&(h.restart(),i.classList.remove("restart"),i.classList.add("start"),i.innerText="Start",s.classList.remove("hidden"),r.classList.add("hidden"),a.classList.add("hidden")),h.updateGameBoard()}),c();
//# sourceMappingURL=index.eb7e8976.js.map
